var app=angular.module("app",["ui.router","ngAnimate"]);app.config(function(n){n.state("EmployeeList",{url:"/EmployeeList",templateUrl:"Assessment/EmployeeList"}).state("AssessEmployee",{url:"/AssessEmployee",templateUrl:"Assessment/AssessEmployee"})});app.run(["$http","$window",function(n){n.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";n.defaults.headers.common.__RequestVerificationToken=$("input[name=__RequestVerificationToken]").val()}]);app.service("appService",["$http",function(n){this.GetAllEmployees=function(t){return n.post("Assessment/GetAllEmployees",t)};this.GetAllEmployeesWithState=function(t){return n.post("Assessment/GetAllEmployeesWithState",t)};this.GetAllEmployeesWithStateByRole=function(t){return n.post("Assessment/GetAllEmployeesWithStateByRole",t)};this.GetResponse=function(t){return n.post("Assessment/GetResponse",t)};this.GetAllSelfAssessments=function(t){return n.post("Assessment/GetAllSelfAssessments",t)};this.CreateMResponse=function(t){return n.post("Assessment/CreateMResponse",t)};this.GetMResponse=function(t){return n.post("Assessment/GetMResponse",t)};this.GetMixResponse=function(t){return n.post("Assessment/GetMixResponse",t)};this.CreateMixResponse=function(t){return n.post("Assessment/CreateMixResponse",t)};this.GetResponseByYear=function(t){return n.post("Assessment/GetResponseByYear",t)};this.UpdateFeedback=function(t){return n.post("Assessment/UpdateFeedback",t)};this.GetFeedback=function(t){return n.post("Assessment/GetFeedback",t)}}]);app.factory("myFactory",function(){function t(t){n.EmployeeInfo=t}function i(){return n}var n={};return{set:t,get:i}});app.controller("FeedbackCtrl",["$scope","$location","appService","$rootScope","myFactory",function(n,t){t.path("/EmployeeList")}]);app.controller("EmployeeListCtrl",["$scope","$location","appService","$rootScope","myFactory",function(n,t,i,r,u){n.Employees=[];i.GetAllEmployeesWithStateByRole({}).then(function(t){n.Employees=t.data}).catch(function(){alert("Error")});n.Review=function(n){t.path("/AssessEmployee");u.set(n)}}]);app.controller("AssessEmployeeCtrl",["$scope","$window","appService","$rootScope","myFactory","$timeout",function(n,t,i,r,u,f){function s({target:n}){n.classList.contains("autoExpand")&&!0&&(n.style.height="",n.style.height=Math.min(n.scrollHeight,e)+"px")}const o=["優良","普通","尚可","待加強","N/A"],e=250;n.name=u.get().EmployeeInfo.Employee.name;n.GetResponseByYear=function(t){i.GetResponseByYear({year:t,empno:u.get().EmployeeInfo.Employee.empno}).then(function(t){for(let n=0;n!==t.data.Responses.length;n++)t.data.Responses[n].Choice.includes("option")&&(t.data.Responses[n].Choice=o[Number(t.data.Responses[n].Choice.slice(6))-1]);for(var r=0;r<t.data.Responses.length;r++)t.data.Responses[r].Content==="自評摘要"&&t.data.Responses.splice(r+1,0,{CategoryId:t.data.Responses[r].CategoryId,Content:"意見回饋"});return n.Responses=t.data.Responses,i.GetFeedback({empno:u.get().EmployeeInfo.Employee.empno})}).then(function(t){var r,i;for(n.state=t.data.State,r=0,i=0;i<n.Responses.length;i++)n.Responses[i].Content==="意見回饋"&&(n.Responses[i].Choice=t.data.Text[r],r++);n.feedback=t.data.Text[r];f(function(){const n=document.querySelectorAll(".autoExpand");for(let n of n)n.style.height="",n.style.height=Math.min(n.scrollHeight,e)+"px"},0)}).catch(function(){alert("Error")})};n.GetResponseByYear();n.UpdateFeedback=function(r){for(var o=[],e=0;e<n.Responses.length;e++)n.Responses[e].Content==="意見回饋"&&o.push(n.Responses[e].Choice);o.push(n.feedback);i.UpdateFeedback({feedbacks:o,state:r,empno:u.get().EmployeeInfo.Employee.empno}).then(function(){r==="save"?(n.succeed=!0,f(function(){n.succeed=!1},2e3)):t.location.href="Assessment/Feedback"})};document.addEventListener("input",s)}]);