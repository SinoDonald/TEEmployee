var app=angular.module("app",["ui.router","ngAnimate"]);app.config(["$stateProvider","$urlRouterProvider",function(n){n.state("EmployeeList",{url:"/EmployeeList",templateUrl:"Assessment/EmployeeList"}).state("AssessEmployee",{url:"/AssessEmployee",templateUrl:"Assessment/AssessEmployee"}).state("ReviewEmployee",{url:"/ReviewEmployee",templateUrl:"Assessment/ReviewEmployee"})}]);app.run(["$http","$window",function(n){n.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";n.defaults.headers.common.__RequestVerificationToken=$("input[name=__RequestVerificationToken]").val()}]);app.service("appService",["$http",function(n){this.GetAllEmployees=function(t){return n.post("Assessment/GetAllEmployees",t)};this.GetAllEmployeesWithState=function(t){return n.post("Assessment/GetAllEmployeesWithState",t)};this.GetAllEmployeesWithStateByRole=function(t){return n.post("Assessment/GetAllEmployeesWithStateByRole",t)};this.GetResponse=function(t){return n.post("Assessment/GetResponse",t)};this.GetAllSelfAssessments=function(t){return n.post("Assessment/GetAllSelfAssessments",t)};this.CreateMResponse=function(t){return n.post("Assessment/CreateMResponse",t)};this.GetMResponse=function(t){return n.post("Assessment/GetMResponse",t)};this.GetMixResponse=function(t){return n.post("Assessment/GetMixResponse",t)};this.CreateMixResponse=function(t){return n.post("Assessment/CreateMixResponse",t)};this.GetResponseByYear=function(t){return n.post("Assessment/GetResponseByYear",t)};this.UpdateFeedback=function(t){return n.post("Assessment/UpdateFeedback",t)};this.GetFeedback=function(t){return n.post("Assessment/GetFeedback",t)};this.GetAllOtherFeedbacks=function(t){return n.post("Assessment/GetAllOtherFeedbacks",t)};this.UpdateFeedbackNotification=t=>n.post("Assessment/UpdateFeedbackNotification",t);this.GetReviewByYear=t=>n.post("Assessment/GetReviewByYear",t);this.GetYearList=t=>n.post("Assessment/GetChartYearList",t);this.GetAllFeedbacksForManager=t=>n.post("Assessment/GetAllFeedbacksForManager",t)}]);app.factory("myFactory",function(){function i(t,i){n.EmployeeInfo=t;n.isBoss=i}function r(){return n}function u(n){t.EmployeeInfo=n}function f(){return t}var n={},t={};return{set:i,get:r,setReview:u,getReview:f}});app.controller("FeedbackCtrl",["$scope","$location","appService","$rootScope","myFactory",function(n,t){t.path("/EmployeeList")}]);app.controller("EmployeeListCtrl",["$scope","$location","appService","$rootScope","myFactory",function(n,t,i,r,u){n.Employees=[];n.sortBy=function(t){n.propertyName=t};i.GetAllEmployeesWithStateByRole({}).then(function(t){n.Employees=t.data}).catch(function(){alert("Error")});n.Review=function(n,i){t.path("/AssessEmployee");u.set(n,i)};n.ReviewEmployee=function(n){t.path("/ReviewEmployee");u.setReview(n)}}]);app.controller("AssessEmployeeCtrl",["$scope","$window","appService","$rootScope","myFactory","$timeout",function(n,t,i,r,u,f){function s({target:n}){n.classList.contains("autoExpand")&&!0&&(n.style.height="",n.style.height=Math.min(n.scrollHeight,e)+"px")}const o=["優良","普通","尚可","待加強","N/A"],e=250;n.name=u.get().EmployeeInfo.Employee.name;n.isBoss=u.get().isBoss;n.GetResponseByYear=function(t){i.GetResponseByYear({year:t,empno:u.get().EmployeeInfo.Employee.empno}).then(function(t){for(let n=0;n!==t.data.Responses.length;n++)t.data.Responses[n].Choice.includes("option")&&(t.data.Responses[n].Choice=o[Number(t.data.Responses[n].Choice.slice(6))-1]);for(var r=0;r<t.data.Responses.length;r++)t.data.Responses[r].Content==="自評摘要"&&t.data.Responses.splice(r+1,0,{CategoryId:t.data.Responses[r].CategoryId,Content:"意見回饋"});return n.Responses=t.data.Responses,n.isBoss?i.GetAllOtherFeedbacks({empno:u.get().EmployeeInfo.Employee.empno}):i.GetFeedback({empno:u.get().EmployeeInfo.Employee.empno})}).then(function(t){if(n.isBoss){n.state="submit";let i=0;for(let r=0;r<n.Responses.length;r++)if(n.Responses[r].Content==="意見回饋"){n.Responses[r].Choice="";for(let t of t.data)t.Text[i]&&(n.Responses[r].Choice+="\n"+t.Name+":\n"+t.Text[i]+"\n");i++}n.feedback="";for(let t of t.data)t.Text[i]&&(n.feedback+="\n"+t.Name+":\n"+t.Text[i]+"\n")}else{n.state=t.data.State;let i=0;for(let r=0;r<n.Responses.length;r++)n.Responses[r].Content==="意見回饋"&&(n.Responses[r].Choice=t.data.Text[i],i++);n.feedback=t.data.Text[i]}f(function(){var n=document.querySelectorAll(".autoExpand");for(let n of n)n.style.height="",n.style.height=Math.min(n.scrollHeight,e)+"px"},0)}).catch(function(){alert("Error")})};n.GetResponseByYear();n.UpdateFeedback=function(r){for(var s,o=[],e=0;e<n.Responses.length;e++)n.Responses[e].Content==="意見回饋"&&o.push(n.Responses[e].Choice);s=0;o.push(n.feedback);i.UpdateFeedback({feedbacks:o,state:r,empno:u.get().EmployeeInfo.Employee.empno}).then(function(){r==="save"?(n.succeed=!0,f(function(){n.succeed=!1},2e3)):i.UpdateFeedbackNotification({empno:u.get().EmployeeInfo.Employee.empno}).then(()=>{t.location.href="Assessment/Feedback"})})};document.addEventListener("input",s)}]);app.controller("ReviewEmployeeCtrl",["$scope","$window","appService","$rootScope","myFactory","$timeout","$q",function(n,t,i,r,u,f,e){const o=["優良","普通","尚可","待加強","N/A"];n.empData=u.getReview();n.name=n.empData.EmployeeInfo.Employee.name;i.GetYearList({isManagerResponse:!1}).then(t=>{n.years=t.data,n.selectedYear=n.years[0],n.GetReviewByYear(n.selectedYear)});n.GetReviewByYear=function(t){let r=i.GetReviewByYear({year:t,empno:n.empData.EmployeeInfo.Employee.empno}),u=i.GetAllFeedbacksForManager({year:t,empno:n.empData.EmployeeInfo.Employee.empno});e.all([r,u]).then(t=>{n.data=t[0].data;n.feedbacks=t[1].data;for(let t=0;t!==n.data.Responses.length;t++)n.data.Responses[t].Choice.includes("option")&&(n.data.Responses[t].Choice=o[Number(n.data.Responses[t].Choice.slice(6))-1]);for(var i=0;i<n.data.Responses.length;i++)n.data.Responses[i].Content==="自評摘要"&&n.data.Responses.splice(i+1,0,{CategoryId:n.data.Responses[i].CategoryId,Content:"意見回饋"});let r=0;for(let t=0;t<n.data.Responses.length;t++)if(n.data.Responses[t].Content==="意見回饋"){n.data.Responses[t].Choice="";for(let i of n.feedbacks)i.Text[r]&&(n.data.Responses[t].Choice+="\n"+i.Name+":\n"+i.Text[r]+"\n");r++}n.feedback="";for(let t of n.feedbacks)t.Text[r]&&(n.feedback+="\n"+t.Name+":\n"+t.Text[r]+"\n")})}}]);